<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel | Nucleon Coaching Institutes</title>

  <link rel="icon" href="https://img.icons8.com/ios-filled/50/800000/graduation-cap.png" type="image/x-icon">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Variables */
    :root {
      --primary: #800000;
      --primary-dark: #5e0f0f;
      --primary-light: #a01a1a;
      --secondary: #0f766e;
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --info: #0284c7;

      --gray-25: #fafbfc;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-150: #ebedef;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --white: #ffffff;

      --font-primary: 'Inter', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;

      --radius-sm: 0.375rem;
      --radius: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;

      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

      --sidebar-width: 280px;
      --header-height: 70px;

      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-primary);
      background-color: var(--gray-50);
      color: var(--gray-900);
      line-height: 1.6;
    }

    /* LOGIN SCREEN */
    #login-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }

    #login-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      pointer-events: none;
    }

    .login-container {
      width: 100%;
      max-width: 420px;
      background: var(--white);
      padding: 3rem 2.5rem;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      text-align: center;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .login-header {
      margin-bottom: 2.5rem;
    }

    .login-logo {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      box-shadow: var(--shadow-lg);
    }

    .login-logo i {
      font-size: 2rem;
      color: var(--white);
    }

    .login-header h2 {
      margin: 0 0 0.5rem;
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--gray-900);
    }

    .login-header p {
      margin: 0;
      color: var(--gray-600);
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--gray-700);
      font-size: 0.875rem;
    }

    .input-wrapper {
      position: relative;
    }

    .input-wrapper .icon {
      position: absolute;
      top: 50%;
      left: 1rem;
      transform: translateY(-50%);
      color: var(--gray-400);
      font-size: 0.875rem;
    }

    .form-control {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 2.75rem;
      border: 2px solid var(--gray-200);
      border-radius: var(--radius);
      font-size: 0.95rem;
      transition: var(--transition);
      background: var(--white);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(128, 0, 0, 0.1);
    }

    .form-control::placeholder {
      color: var(--gray-400);
    }

    .toggle-password {
      position: absolute;
      top: 50%;
      right: 1rem;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--gray-400);
      font-size: 0.875rem;
      transition: var(--transition);
    }

    .toggle-password:hover {
      color: var(--gray-600);
    }

    .btn {
      display: inline-block;
      width: 100%;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: var(--transition);
      margin-top: 1rem;
      box-shadow: var(--shadow);
    }

    .btn:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }

    .btn:active {
      transform: translateY(0);
    }

    .back-to-site {
      margin-top: 2rem;
      font-size: 0.9rem;
    }

    .back-to-site a {
      color: var(--gray-600);
      text-decoration: none;
      transition: var(--transition);
    }

    .back-to-site a:hover {
      color: var(--primary);
    }

    /* ADMIN PANEL STYLES */
    #admin-panel {
      display: none;
      min-height: 100vh;
    }

    #admin-panel.active {
      display: flex;
      flex-direction: column;
    }

    #login-screen.hidden {
      display: none;
    }

    /* Header */
    .admin-header {
      height: var(--header-height);
      background: var(--white);
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .hamburger {
      display: none;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--gray-600);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius);
      transition: var(--transition);
    }

    .hamburger:hover {
      background: var(--gray-100);
      color: var(--gray-900);
    }

    .admin-header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-900);
    }

    .admin-user {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius);
      transition: var(--transition);
    }


    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: var(--shadow);
    }

    .admin-user span {
      font-weight: 500;
      color: var(--gray-700);
      font-size: 0.9rem;
    }

    /* Container */
    .admin-container {
      display: flex;
      flex: 1;
      position: relative;
    }

    /* Sidebar */
    .admin-sidebar {
      width: var(--sidebar-width);
      background: var(--white);
      border-right: 1px solid var(--gray-200);
      padding: 1.5rem 0;
      overflow-y: auto;
      transition: var(--transition);
      position: fixed;
      top: var(--header-height);
      left: 0;
      bottom: 0;
      z-index: 50;
      box-shadow: var(--shadow-sm);
    }

    .admin-nav {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-item {
      margin-bottom: 0.25rem;
    }

    .nav-link,
    .submenu-toggle {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.875rem 1.5rem;
      color: var(--gray-700);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: var(--transition);
      border: none;
      background: none;
      width: 100%;
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .nav-link:hover,
    .submenu-toggle:hover {
      background: var(--gray-50);
      color: var(--primary);
      border-left-color: var(--primary);
    }

    .nav-link.active {
      background: rgba(128, 0, 0, 0.1);
      color: var(--primary);
      border-left-color: var(--primary);
      font-weight: 600;
    }

    .nav-link i,
    .submenu-toggle i {
      width: 18px;
      text-align: center;
      font-size: 1rem;
    }

    .submenu {
      list-style: none;
      margin: 0;
      padding: 0;
      background: var(--gray-50);
      border-left: 2px solid var(--gray-200);
      margin-left: 1.5rem;
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.3s ease-out;
    }

    .submenu.active {
      max-height: 300px;
      transition: max-height 0.3s ease-in;
    }

    .submenu .nav-link {
      padding: 0.75rem 1.5rem 0.75rem 2rem;
      font-size: 0.875rem;
      font-weight: 400;
    }

    .submenu .nav-link:hover {
      background: var(--white);
    }

    .submenu .nav-link.active {
      background: var(--white);
      border-left-color: var(--primary);
    }

    .submenu-toggle::after {
      content: '\f107';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      margin-left: auto;
      transition: var(--transition);
    }

    .submenu-toggle.expanded::after {
      transform: rotate(180deg);
    }

    /* Main Content */
    .admin-main {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 1.5rem;
      transition: var(--transition);
      min-height: calc(100vh - var(--header-height));
    }

    /* Stats Cards */
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--white);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      border: 1px solid var(--gray-200);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .stat-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--gray-600);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .stat-number {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--gray-900);
      font-family: var(--font-mono);
    }

    /* Panel Header */
    .panel-header {
      background: var(--white);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      border: 1px solid var(--gray-200);
      margin-bottom: 1.5rem;
    }

    .panel-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 0.25rem;
    }

    .panel-sub {
      color: var(--gray-600);
      font-size: 0.95rem;
    }

    /* Content Panels */
    .content-panel {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .content-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Table Wrapper */
    .table-wrapper {
      background: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      border: 1px solid var(--gray-200);
      overflow-x: auto;
    }

    .table-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gray-50);
    }

    .table-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--gray-900);
    }

    .table-actions {
      display: flex;
      gap: 0.75rem;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      border-radius: var(--radius);
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: var(--gray-200);
      color: var(--gray-700);
    }

    .btn-secondary:hover {
      background: var(--gray-300);
    }

    .search-wrapper {
      position: relative;
      max-width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 0.5rem 0.75rem 0.5rem 2.25rem;
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      font-size: 0.875rem;
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(128, 0, 0, 0.1);
    }

    .search-wrapper .icon {
      position: absolute;
      top: 50%;
      left: 0.75rem;
      transform: translateY(-50%);
      color: var(--gray-400);
      font-size: 0.875rem;
    }

    /* Enhanced Table Styles */
    .submissions-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
        background: var(--white);
        border: 2px solid var(--gray-300);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    }
    
    .submissions-table th, .submissions-table td {
        padding: 15px 18px;
        border: 1px solid var(--gray-200);
        text-align: left;
        vertical-align: middle;
    }
    
    .submissions-table th {
        background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
        font-weight: 700;
        color: var(--gray-800);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .submissions-table tbody tr {
        transition: var(--transition);
    }
    
    .submissions-table tbody tr:hover {
        background-color: var(--gray-25);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .submissions-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .submissions-table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px;
        color: var(--gray-700);
        font-weight: 500;
    }
    
    /* Mobile table optimization */
    @media (max-width: 768px) {
        .submissions-table td {
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 120px;
            min-width: 80px;
        }
        
        .submissions-table td:nth-child(2),
        .submissions-table td:nth-child(3) {
            max-width: 100px;
        }
        
        .submissions-table th:nth-child(2),
        .submissions-table th:nth-child(3) {
            max-width: 100px;
        }
    }
    
    .submissions-table td:first-child {
        font-weight: 600;
        color: var(--gray-800);
    }
    
    .action-btn {
        padding: 6px 12px;
        border: 1px solid var(--gray-300);
        background-color: var(--white);
        color: var(--gray-700);
        cursor: pointer;
        border-radius: var(--radius);
        margin-right: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    .action-btn:last-child {
        margin-right: 0;
    }
    
    .action-btn.view-btn {
        border-color: var(--info);
        color: var(--info);
    }
    
    .action-btn.view-btn:hover {
        background-color: var(--info);
        color: var(--white);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }
    
    .action-btn.delete-btn {
        border-color: var(--danger);
        color: var(--danger);
    }
    
    .action-btn.delete-btn:hover {
        background-color: var(--danger);
        color: var(--white);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }
    
    .col-action {
        text-align: right;
        white-space: nowrap;
        width: 1%;
        min-width: 120px;
    }

    /* Detail View Styles - Enhanced */
    #application-detail-view .panel {
        background: var(--white);
        padding: 2.5rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        border: 1px solid var(--gray-100);
        max-width: 1200px;
        margin: 0 auto;
    }
    
    #application-detail-view .back-btn {
        margin-bottom: 2rem;
        background: var(--gray-100);
        border: 1px solid var(--gray-200);
        color: var(--primary);
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius);
        transition: var(--transition);
        font-size: 0.9rem;
    }
    
    #application-detail-view .back-btn:hover {
        background: var(--primary);
        color: var(--white);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }
    
    #application-detail-view h3 {
        margin-top: 0;
        margin-bottom: 2.5rem;
        border-bottom: 2px solid var(--primary);
        padding-bottom: 1rem;
        color: var(--gray-900);
        font-size: 1.75rem;
        font-weight: 700;
        position: relative;
    }
    
    #application-detail-view h3::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 60px;
        height: 2px;
        background: var(--primary-light);
    }
    
    .form-view-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
        width: 100%;
        overflow: hidden;
    }
    
    .form-field {
        margin-bottom: 1.75rem;
        position: relative;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }
    
    .field-label {
        display: block;
        font-weight: 700;
        color: var(--gray-700);
        margin-bottom: 0.75rem;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.75px;
        position: relative;
        padding-left: 1rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        max-width: 100%;
    }
    
    .field-label::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        border-radius: 2px;
    }
    
    .field-value {
        background: var(--white);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: 1rem 1.25rem;
        color: var(--gray-800);
        font-size: 1rem;
        line-height: 1.6;
        min-height: 3rem;
        display: flex;
        align-items: flex-start;
        white-space: pre-wrap;
        word-wrap: break-word;
        word-break: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
        position: relative;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }
    
    .field-value:hover {
        border-color: var(--primary-light);
        box-shadow: var(--shadow-md);
    }
    
    .field-value:empty::before {
        content: '[Not provided]';
        color: var(--gray-400);
        font-style: italic;
        opacity: 0.7;
    }
    
    /* Desktop specific enhancements */
    @media (min-width: 1024px) {
        .form-view-container {
            grid-template-columns: repeat(2, 1fr);
            gap: 2.5rem;
        }
        
        .field-value {
            font-size: 1.05rem;
            padding: 1.25rem 1.5rem;
        }
        
        #application-detail-view .panel {
            padding: 3rem;
        }
    }
    
    /* Tablet responsive */
    @media (max-width: 1023px) and (min-width: 769px) {
        .form-view-container {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        #application-detail-view .panel {
            padding: 2rem;
        }
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
        .form-view-container {
            grid-template-columns: 1fr;
            gap: 1.25rem;
            padding: 0;
            margin: 0;
        }
        
        #application-detail-view .panel {
            padding: 1.5rem;
            margin: 1rem;
            border-radius: var(--radius-lg);
            max-width: calc(100vw - 2rem);
            overflow-x: hidden;
        }
        
        #application-detail-view h3 {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .form-field {
            width: 100%;
            max-width: 100%;
            margin-bottom: 1.5rem;
        }
        
        .field-label {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            padding-left: 0.75rem;
        }
        
        .field-value {
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
            min-height: 2.5rem;
            width: 100%;
            max-width: 100%;
        }
        
        #application-detail-view .back-btn {
            padding: 0.625rem 1.25rem;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }
    }


    /* Enhanced Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--gray-500);
      background: var(--white);
      border-radius: var(--radius-lg);
      border: 2px dashed var(--gray-200);
      margin: 1rem 0;
    }

    .empty-state i {
      font-size: 3.5rem;
      margin-bottom: 1.5rem;
      color: var(--gray-300);
      opacity: 0.7;
    }

    .empty-state h3 {
      font-size: 1.35rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--gray-700);
    }
    
    .empty-state p {
      color: var(--gray-500);
      font-size: 0.95rem;
      margin-top: 0.5rem;
    }

    /* Footer */
    .admin-footer {
      margin-top: auto;
      padding: 2rem 0;
      text-align: center;
      color: var(--gray-500);
      font-size: 0.875rem;
      border-top: 1px solid var(--gray-200);
      background: var(--white);
    }

    /* Sidebar Backdrop */
    .sidebar-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 40;
    }

    .sidebar-backdrop.show {
      display: block;
    }

    /* Enhanced Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
      color: var(--gray-500);
      background: var(--white);
      border-radius: var(--radius-lg);
      margin: 1rem 0;
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--gray-200);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Enhanced Responsive Design */
    
    /* Large Desktop */
    @media (min-width: 1440px) {
      .admin-main {
        padding: 2rem 3rem;
      }
      
      .table-wrapper {
        border-radius: var(--radius-xl);
      }
      
      .submissions-table {
        font-size: 1rem;
      }
      
      .submissions-table th, .submissions-table td {
        padding: 16px 20px;
      }
    }
    
    /* Desktop */
    @media (min-width: 1024px) and (max-width: 1439px) {
      .admin-main {
        padding: 1.75rem 2rem;
      }
      
      .submissions-table th, .submissions-table td {
        padding: 14px 18px;
      }
    }
    
    /* Tablet */
    @media (max-width: 1023px) and (min-width: 769px) {
      .hamburger {
        display: block;
      }

      .admin-sidebar {
        transform: translateX(-100%);
        width: 260px;
      }

      .admin-sidebar.open {
        transform: translateX(0);
      }

      .admin-main {
        margin-left: 0;
        padding: 1.5rem;
      }
      
      .submissions-table {
        font-size: 0.9rem;
      }
      
      .submissions-table th, .submissions-table td {
        padding: 12px 15px;
      }
      
      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .action-btn {
        padding: 4px 8px;
        font-size: 0.8rem;
      }
    }
    
    /* Mobile */
    @media (max-width: 768px) {
      .hamburger {
        display: block;
      }

      .admin-sidebar {
        transform: translateX(-100%);
        width: 280px;
        z-index: 60;
      }

      .admin-sidebar.open {
        transform: translateX(0);
      }

      .admin-main {
        margin-left: 0;
        padding: 1rem;
        overflow-x: hidden;
      }
      
      .admin-header {
        padding: 0 1rem;
        height: 60px;
      }
      
      .admin-header h1 {
        font-size: 1.25rem;
      }
      
      .submissions-table {
        font-size: 0.8rem;
        table-layout: fixed;
        width: 100%;
      }
      
      .submissions-table th, .submissions-table td {
        padding: 8px 4px;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
      }
      
      .submissions-table th:nth-child(1),
      .submissions-table td:nth-child(1) {
        width: 25%;
        min-width: 70px;
      }
      
      .submissions-table th:nth-child(2),
      .submissions-table td:nth-child(2) {
        width: 35%;
        min-width: 80px;
      }
      
      .submissions-table th:nth-child(3),
      .submissions-table td:nth-child(3) {
        width: 25%;
        min-width: 70px;
      }
      
      .submissions-table th:nth-child(4),
      .submissions-table td:nth-child(4) {
        width: 15%;
        min-width: 90px;
      }
      
      .table-wrapper {
        overflow-x: hidden;
        border-radius: var(--radius);
        margin: 0 -1rem;
        padding: 0 1rem;
      }
      
      .action-btn {
        padding: 2px 4px;
        font-size: 0.7rem;
        margin-right: 2px;
        display: inline-block;
        margin-bottom: 2px;
      }
      
      .col-action {
        text-align: center;
      }
      
      .empty-state {
        padding: 2rem 1rem;
      }
      
      .empty-state h3 {
        font-size: 1.1rem;
      }
      
      .loading {
        padding: 2rem 1rem;
      }
    }
    
    /* Small Mobile */
    @media (max-width: 480px) {
      .admin-main {
        padding: 0.5rem;
        overflow-x: hidden;
      }
      
      .admin-header {
        padding: 0 0.5rem;
      }
      
      .admin-sidebar {
        width: 260px;
      }
      
      .submissions-table {
        font-size: 0.75rem;
        table-layout: fixed;
      }
      
      .submissions-table th, .submissions-table td {
        padding: 6px 2px;
        font-size: 0.75rem;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
      }
      
      .submissions-table th:nth-child(1),
      .submissions-table td:nth-child(1) {
        width: 22%;
        min-width: 60px;
      }
      
      .submissions-table th:nth-child(2),
      .submissions-table td:nth-child(2) {
        width: 38%;
        min-width: 70px;
      }
      
      .submissions-table th:nth-child(3),
      .submissions-table td:nth-child(3) {
        width: 25%;
        min-width: 60px;
      }
      
      .submissions-table th:nth-child(4),
      .submissions-table td:nth-child(4) {
        width: 15%;
        min-width: 80px;
      }
      
      .action-btn {
        padding: 1px 3px;
        font-size: 0.65rem;
        margin-right: 1px;
        margin-bottom: 1px;
        display: block;
        width: 100%;
        text-align: center;
      }
      
      .table-wrapper {
        margin: 0 -0.5rem;
        padding: 0 0.5rem;
        border-radius: 0;
        overflow-x: hidden;
      }
      
      /* Enhanced small mobile form view */
      .form-view-container {
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 0;
      }
      
      #application-detail-view .panel {
        padding: 1rem;
        margin: 0.5rem;
        max-width: calc(100vw - 1rem);
      }
      
      .field-value {
        padding: 0.75rem;
        font-size: 0.9rem;
        min-height: 2rem;
      }
      
      .field-label {
        font-size: 0.75rem;
        padding-left: 0.5rem;
      }
    }

    /* Notification styles */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      max-width: 400px;
      animation: slideIn 0.3s ease-out;
    }

    .notification.success {
      background: var(--success);
      color: var(--white);
    }

    .notification.error {
      background: var(--danger);
      color: var(--white);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>

   <!-- Favicon -->
   <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>

<body>

  <div id="login-screen">
    <div class="login-container">
      <div class="login-header">
        <div class="login-logo">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <h2>Admin Panel</h2>
        <p>Sign in to access the Nucleon Coaching dashboard</p>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <div class="input-wrapper">
            <i class="fas fa-user icon"></i>
            <input type="text" id="username" name="username" class="form-control" placeholder="Enter your username" required
              autocomplete="username">
          </div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-wrapper">
            <i class="fas fa-lock icon"></i>
            <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password"
              required autocomplete="current-password">
            <i class="fas fa-eye-slash toggle-password" id="togglePassword"></i>
          </div>
        </div>

        <button type="submit" class="btn">
          <span id="login-text">Sign In</span>
          <div id="login-spinner" class="spinner" style="display: none; margin: 0 auto;"></div>
        </button>
      </form>

      <p class="back-to-site">
        <a href="index.html"><i class="fas fa-arrow-left"></i> Back to Main Website</a>
      </p>
    </div>
  </div>

  <div id="admin-panel">
    <header class="admin-header">
      <button id="menuToggle" class="hamburger" aria-label="Toggle Menu">
        <i class="fas fa-bars"></i>
      </button>
      <h1>Nucleon Admin</h1>
      <div class="admin-user">
        <button class="btn-sm" style="background: var(--danger); color: var(--white);" id="performLogoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
        </div>
    </header>

    <div class="admin-container">
      <aside class="admin-sidebar" id="sidebar" aria-label="Navigation">
        <ul class="admin-nav">
          <!-- <li class="nav-item">
            <a href="#" class="nav-link" data-target="dashboard">
              <i class="fas fa-chart-line"></i> Dashboard
            </a>
          </li> -->
          <li class="nav-item">
            <button class="submenu-toggle expanded">
                <i class="fas fa-handshake"></i> Partnerships
            </button>
            <ul class="submenu active">
                <li><a href="#" class="nav-link" data-target="school-integration">
                    <i class="fas fa-school"></i> School Integration
                </a></li>
                <li><a href="#" class="nav-link" data-target="study-centers">
                    <i class="fas fa-building"></i> Study Centers
                </a></li>
                <li><a href="#" class="nav-link" data-target="distance-learning">
                    <i class="fas fa-laptop"></i> Distance Learning
                </a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-target="educators">
              <i class="fas fa-chalkboard-teacher"></i> Educators
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-target="contacts">
              <i class="fas fa-envelope"></i> Contact Submissions
            </a>
          </li>
          
        </ul>
      </aside>

      <main class="admin-main" role="main">
        <!-- <div id="statsCards" class="stats-cards">
          <div class="stat-card">
            <div class="stat-label">Total Submissions</div>
            <div id="stat-total" class="stat-number">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">School Integration</div>
            <div id="stat-partnership-school" class="stat-number">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Study Centers</div>
            <div id="stat-partnership-study" class="stat-number">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Distance Learning</div>
            <div id="stat-partnership-distance" class="stat-number">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Educators</div>
            <div id="stat-educator" class="stat-number">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Contact Forms</div>
            <div id="stat-contact" class="stat-number">0</div>
          </div>
        </div>         -->

        <section id="school-integration" class="content-panel">
          <div class="table-wrapper">
             <div id="school-table-container"><div class="loading"><div class="spinner"></div>Loading...</div></div>
          </div>
        </section>

        <section id="study-centers" class="content-panel">
            <div class="table-wrapper">
                <div id="study-table-container"><div class="loading"><div class="spinner"></div>Loading...</div></div>
            </div>
        </section>

        <section id="distance-learning" class="content-panel">
            <div class="table-wrapper">
                <div id="distance-table-container"><div class="loading"><div class="spinner"></div>Loading...</div></div>
            </div>
        </section>
        
        <section id="educators" class="content-panel">
            <div class="table-wrapper">
                <div id="educators-table-container"><div class="loading"><div class="spinner"></div>Loading...</div></div>
            </div>
        </section>

        <section id="contacts" class="content-panel">
            <div class="table-wrapper">
                <div id="contacts-table-container"><div class="loading"><div class="spinner"></div>Loading...</div></div>
            </div>
        </section>

        

        <section id="logout" class="content-panel">
            <div class="table-wrapper">
              <div style="padding: 3rem; text-align: center;">
                <i class="fas fa-sign-out-alt" style="font-size: 3rem; color: var(--gray-300); margin-bottom: 1rem;"></i>
                <h3>Logout Confirmation</h3>
                <p style="color: var(--gray-600); margin-bottom: 2rem;">Are you sure you want to logout from the admin panel?</p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                  <button class="btn-sm btn-secondary" id="cancelLogoutBtn">Cancel</button>
                  <button class="btn-sm" style="background: var(--danger); color: var(--white);" id="performLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                  </button>
                </div>
              </div>
            </div>
        </section>
        
        <div id="application-detail-view" class="content-panel"></div>

        <!-- <footer class="admin-footer">
          <p>&copy; 2025 Nucleon Coaching Institutes. All rights reserved.</p>
        </footer> -->
      </main>
    </div>
    <div id="sidebarBackdrop" class="sidebar-backdrop"></div>
  </div>
  
  <script>
    (function () {
        // --- DATA ---
        const SAMPLE = {
            schoolIntegration: [],
            studyCenters: [],
            distanceLearning: [],
            educators: [],
            contacts: [],
            trash: []
        };

        // --- DOM ELEMENTS ---
        const loginForm = document.getElementById("loginForm");
        const loginScreen = document.getElementById("login-screen");
        const adminPanel = document.getElementById("admin-panel");
        const togglePassword = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        
        const statsCardsContainer = document.getElementById('statsCards');
        const panelHeaderContainer = document.getElementById('panelHeader');
        const allContentPanels = document.querySelectorAll('.admin-main > section.content-panel');
        const applicationDetailView = document.getElementById('application-detail-view');

        // --- UTILITY FUNCTIONS ---
        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 3000);
        }

        // Format a date/time input into `12 Jan 25`. Falls back gracefully if invalid
        function formatDateShort(val) {
            if (!val) return 'N/A';
            const d = new Date(val);
            if (isNaN(d)) return val; // keep original if not a valid date
            const day = d.getDate();
            const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const mon = months[d.getMonth()];
            const yr = String(d.getFullYear()).slice(-2);
            return `${day} ${mon} ${yr}`;
        }
        
        // --- LOGIN & LOGOUT ---
        async function handleLogin(e) {
            e.preventDefault();
            const loginText = document.getElementById('login-text');
            const loginSpinner = document.getElementById('login-spinner');
            const submitBtn = e.target.querySelector('.btn');

            loginText.style.display = 'none';
            loginSpinner.style.display = 'block';
            submitBtn.disabled = true;

            try {
                const username = document.getElementById('username').value;
                const password = passwordInput.value;
                
                if (!username || !password) {
                    throw new Error('Please fill in all fields');
                }

                // Send credentials to PHP backend for validation
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                const response = await fetch('admin_login.php', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('Login successful!', 'success');
                    setTimeout(() => {
                        loginScreen.classList.add("hidden");
                        adminPanel.classList.add("active");
                        initializeDashboard();
                    }, 500);
                } else {
                    throw new Error('Invalid username or password');
                }
            } catch (err) {
                showNotification(err.message || 'Login failed.', 'error');
            } finally {
                loginText.style.display = 'inline';
                loginSpinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        function performLogout() {
            showNotification('You have been logged out.', 'success');
            setTimeout(() => {
                adminPanel.classList.remove('active');
                loginScreen.classList.remove('hidden');
                loginForm.reset();
                history.pushState(null, '', window.location.pathname); // Clear hash
            }, 1000);
        }

        function cancelLogout() {
            history.back(); // Go back to the previous panel
        }

        // --- API & DATA LOADING ---
        const API_BASE = "http://127.0.0.1:8000/api";

        async function loadSchoolProjects() {
            try {
                const res = await fetch(`${API_BASE}/school-projects`);
                const json = await res.json();
                if (json.success) {
                    SAMPLE.schoolIntegration = json.data;
                    renderSchoolProjectsTable(json.data);
                    updateActiveStats();
                }
            } catch (e) { console.error("Error loading school projects:", e); }
        }

        async function loadStudyCenters() {
            try {
                const res = await fetch(`${API_BASE}/study-centre-applications`);
                const json = await res.json();
                if (json.success) {
                    SAMPLE.studyCenters = json.data;
                    renderStudyCentersTable(json.data);
                    updateActiveStats();
                }
            } catch (e) { console.error("Error loading study centres:", e); }
        }

        async function loadDistanceLearning() {
            try {
                const res = await fetch(`${API_BASE}/distance-learning`);
                const json = await res.json();
                if (json.success) {
                    SAMPLE.distanceLearning = json.data;
                    renderDistanceLearningTable(json.data);
                    updateActiveStats();
                }
            } catch (e) { console.error("Error loading distance learning:", e); }
        }
        
        async function loadEducators() {
            try {
                const res = await fetch(`${API_BASE}/educators`);
                const json = await res.json();
                if (json.success) {
                    SAMPLE.educators = json.data;
                    renderEducatorsTable(json.data);
                    updateActiveStats();
                }
            } catch (e) { console.error("Error loading educators:", e); }
        }
        
        async function loadContactsFromApi() {
            try {
                const response = await fetch(`${API_BASE}/contacts`);
                const result = await response.json();
                if (result.success) {
                    SAMPLE.contacts = result.data;
                    renderContactsTable(result.data);
                    updateActiveStats();
                }
            } catch (err) { console.error("Error loading contacts:", err); }
        }
        
        // --- STATS ---
        function updateActiveStats() {
            const counts = {
                school: SAMPLE.schoolIntegration.length,
                study: SAMPLE.studyCenters.length,
                distance: SAMPLE.distanceLearning.length,
                educator: SAMPLE.educators.length,
                contact: SAMPLE.contacts.length
            };
            counts.total = counts.school + counts.study + counts.distance + counts.educator + counts.contact;

            const statTotal = document.getElementById('stat-total');
            const statSchool = document.getElementById('stat-partnership-school');
            const statStudy = document.getElementById('stat-partnership-study');
            const statDistance = document.getElementById('stat-partnership-distance');
            const statEducator = document.getElementById('stat-educator');
            const statContact = document.getElementById('stat-contact');
            
            if (statTotal) statTotal.textContent = counts.total;
            if (statSchool) statSchool.textContent = counts.school;
            if (statStudy) statStudy.textContent = counts.study;
            if (statDistance) statDistance.textContent = counts.distance;
            if (statEducator) statEducator.textContent = counts.educator;
            if (statContact) statContact.textContent = counts.contact;
        }

        // --- RENDERING ---
        function renderTable(containerSelector, data, columnOrder, includeActions = false, dataType = '') {
            const container = document.querySelector(containerSelector);
            if (!container) return;
            if (!data || data.length === 0) {
                container.innerHTML = `<div class="empty-state"><h3>No Submissions Found</h3></div>`;
                return;
            }

            const formatHeader = key => key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            const headers = columnOrder.map(key => `<th>${formatHeader(key)}</th>`).join('');
            const actionHeader = includeActions ? `<th class="col-action">Actions</th>` : '';

            const rows = data.map(item => {
                const cells = columnOrder.map(key => {
                    const raw = item[key];
                    const isDateKey = /date|submitted/i.test(key);
                    const value = isDateKey ? formatDateShort(raw) : (raw || 'N/A');
                    return `<td title="${raw}">${value}</td>`;
                }).join('');
                const actionCell = includeActions ? `
                    <td class="col-action">
                        <button class="action-btn delete-btn" data-id="${item.id}" data-type="${dataType}">Delete</button>
                    </td>` : '';
                return `<tr>${cells}${actionCell}</tr>`;
            }).join('');

            container.innerHTML = `
                <table class="submissions-table">
                    <thead><tr>${headers}${actionHeader}</tr></thead>
                    <tbody>${rows}</tbody>
                </table>`;
            
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }

        function renderDetailView(entries, title) {
            let detailHtml = `<div class="panel">
                <button class="back-btn"><i class="fas fa-arrow-left"></i> Back to List</button>
                <h3>${title}</h3>
                <div class="form-view-container">`;

            for (const [label, value] of Object.entries(entries)) {
                detailHtml += `
                    <div class="form-field">
                        <label class="field-label">${label}:</label>
                        <div class="field-value">${value || '[Not provided]'}</div>
                    </div>`;
            }
            detailHtml += `</div></div>`;
            showDetailView(detailHtml);
        }

        function renderSchoolProjectsTable(data) {
            const container = document.querySelector('#school-table-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No school projects found.</h3></div>';
                return;
            }
            const html = `
              <table class="submissions-table">
                <thead><tr><th>Date</th><th>School Name</th><th>Principal</th><th class="col-action">Actions</th></tr></thead>
                <tbody>
                  ${data.map(app => `
                    <tr>
                      <td>${formatDateShort(app.application_date)}</td>
                      <td title="${app.school_name}">${app.school_name}</td>
                      <td title="${app.principal_name}">${app.principal_name}</td>
                      <td class="col-action">
                        <button class="action-btn view-btn" data-id="${app.id}">View</button>
                        <button class="action-btn delete-btn" data-id="${app.id}" data-type="school-project">Delete</button>
                      </td>
                    </tr>`).join("")}
                </tbody>
              </table>`;
            container.innerHTML = html;
            container.querySelectorAll('.view-btn').forEach(btn => 
                btn.addEventListener('click', () => viewSchoolApplication(btn.dataset.id))
            );
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }
        
        function renderEducatorsTable(data) {
            const container = document.querySelector('#educators-table-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No educator applications found.</h3></div>';
                return;
            }
            const html = `
              <table class="submissions-table">
                <thead><tr><th>Date</th><th>Full Name</th><th>Email</th><th class="col-action">Actions</th></tr></thead>
                <tbody>
                  ${data.map(app => `
                    <tr>
                      <td>${formatDateShort(app.submitted_at || app.created_at)}</td>
                      <td title="${app.full_name}">${app.full_name}</td>
                      <td title="${app.email}">${app.email}</td>
                      <td class="col-action">
                        <button class="action-btn view-btn" data-id="${app.id}">View</button>
                        <button class="action-btn delete-btn" data-id="${app.id}" data-type="educator">Delete</button>
                      </td>
                    </tr>`).join("")}
                </tbody>
              </table>`;
            container.innerHTML = html;
            container.querySelectorAll('.view-btn').forEach(btn => 
                btn.addEventListener('click', () => viewEducatorApplication(btn.dataset.id))
            );
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }

        function renderStudyCentersTable(data) {
            const container = document.querySelector('#study-table-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No study centers found.</h3></div>';
                return;
            }
            const html = `
              <table class="submissions-table">
                <thead><tr><th>Date</th><th>Centre Name</th><th>Principal</th><th class="col-action">Actions</th></tr></thead>
                <tbody>
                  ${data.map(app => `
                    <tr>
                      <td>${formatDateShort(app.application_date)}</td>
                      <td>${app.centre_name}</td>
                      <td>${app.principal_name}</td>
                      <td class="col-action">
                        <button class="action-btn view-btn" data-id="${app.id}">View</button>
                        <button class="action-btn delete-btn" data-id="${app.id}" data-type="study-center">Delete</button>
                      </td>
                    </tr>`).join("")}
                </tbody>
              </table>`;
            container.innerHTML = html;
            container.querySelectorAll('.view-btn').forEach(btn => 
                btn.addEventListener('click', () => viewStudyCenterApplication(btn.dataset.id))
            );
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }
        
        function renderDistanceLearningTable(data) {
            const container = document.querySelector('#distance-table-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No distance learning applications found.</h3></div>';
                return;
            }
            const html = `
              <table class="submissions-table">
                <thead><tr><th>Date</th><th>Applicant</th><th>Contact</th><th class="col-action">Actions</th></tr></thead>
                <tbody>
                  ${data.map(app => `
                    <tr>
                      <td>${formatDateShort(app.application_date)}</td>
                      <td>${app.applicant_name}</td>
                      <td>${app.contact_number}</td>
                      <td class="col-action">
                        <button class="action-btn view-btn" data-id="${app.id}">View</button>
                        <button class="action-btn delete-btn" data-id="${app.id}" data-type="distance-learning">Delete</button>
                      </td>
                    </tr>`).join("")}
                </tbody>
              </table>`;
            container.innerHTML = html;
            container.querySelectorAll('.view-btn').forEach(btn => 
                btn.addEventListener('click', () => viewDistanceLearningApplication(btn.dataset.id))
            );
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }
        
        function renderContactsTable(data) {
            const container = document.querySelector('#contacts-table-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No contact submissions found.</h3></div>';
                return;
            }
            const html = `
              <table class="submissions-table">
                <thead><tr><th>Date</th><th>Name</th><th>Program</th><th class="col-action">Actions</th></tr></thead>
                <tbody>
                  ${data.map(contact => `
                    <tr>
                      <td>${formatDateShort(contact.submitted_at)}</td>
                      <td title="${contact.name}">${contact.name}</td>
                      <td title="${contact.program}">${contact.program}</td>
                      <td class="col-action">
                        <button class="action-btn view-btn" data-id="${contact.id}">View</button>
                        <button class="action-btn delete-btn" data-id="${contact.id}" data-type="contact">Delete</button>
                      </td>
                    </tr>`).join("")}
                </tbody>
              </table>`;
            container.innerHTML = html;
            container.querySelectorAll('.view-btn').forEach(btn => 
                btn.addEventListener('click', () => viewContactSubmission(btn.dataset.id))
            );
            container.querySelectorAll('.delete-btn').forEach(btn => 
                btn.addEventListener('click', () => handleDelete(btn.dataset.id, btn.dataset.type))
            );
        }

        // --- VIEW HANDLERS ---
        async function viewSchoolApplication(id) {
            try {
                const res = await fetch(`${API_BASE}/school-projects/${id}`);
                const json = await res.json();
                if (json.success) {
                    const app = json.data;
                    
                    // Format project types
                    const projectTypes = [];
                    if (app.project_science) projectTypes.push('<i class="fas fa-flask" style="color:#800000; margin-right:6px;"></i>Science');
                    if (app.project_math) projectTypes.push('<i class="fas fa-calculator" style="color:#800000; margin-right:6px;"></i>Math');
                    if (app.project_language) projectTypes.push('<i class="fas fa-book" style="color:#800000; margin-right:6px;"></i>Language');
                    if (app.project_social) projectTypes.push('<i class="fas fa-globe" style="color:#800000; margin-right:6px;"></i>Social');
                    if (app.project_other) projectTypes.push(`<i class="fas fa-plus" style="color:#800000; margin-right:6px;"></i>Other: ${app.project_other}`);
                    
                    const html = `
                    <div class="panel school-detail-panel">
                      <style>
                        .school-detail-panel { background: linear-gradient(145deg, #f8f9fa, #ffffff); border: 2px solid #800000; border-radius: 15px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
                        .school-detail-actions { display:flex; justify-content:space-between; align-items:center; gap:0; width:100%; max-width:960px; margin:0 auto 14px; padding:0 8px; }
                        .school-detail-actions .btn { background:#800000; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; width:auto !important; max-width:none; flex:0 0 auto !important; white-space:nowrap; }
                        .school-detail-actions .btn.secondary { background:#555; }
                        .school-form-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:25px; text-align:center; font-size:1.8rem; border-bottom:3px solid #800000; padding-bottom:10px; }
                        .school-institute-header { background: rgba(128,0,0,0.05); border-left: 4px solid #800000; padding: 15px; margin-bottom: 25px; border-radius: 0 8px 8px 0; }
                        .school-date-section { background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
                        .school-info-section { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
                        .school-section-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; border-bottom:2px solid #800000; padding-bottom:8px; display:inline-block; }
                        .school-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; }
                        .school-field { margin-bottom: 20px; }
                        .school-label { display:block; font-weight:600; color:#333; margin-bottom:8px; }
                        .school-value { width:100%; border:2px solid #e9ecef; border-radius:8px; padding:12px; font-size:1rem; background:#f8f9fa; color:#333; min-height:20px; }
                        .school-project-types { background:rgba(128,0,0,0.03); padding:15px; border-radius:8px; margin-bottom:20px; }
                        .school-project-list { display:flex; flex-wrap:wrap; gap:10px; }
                        .school-project-item { display:flex; align-items:center; padding:8px 12px; background:rgba(255,255,255,0.9); border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.08); }
                        .school-declaration-section { background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.1)); border: 2px solid #800000; border-radius: 12px; padding: 25px; margin-bottom: 25px; }
                        .school-declaration-text { color:#333; line-height:1.6; margin-bottom:20px; text-align:justify; background:white; padding:15px; border-radius:8px; border-left:4px solid #800000; }
                        .school-signature-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; background:white; padding:20px; border-radius:8px; }
                        @media print { body *{visibility:hidden;} #application-detail-view, #application-detail-view *{visibility:visible;} #application-detail-view{position:absolute; inset:0;} .school-detail-actions{display:none!important;} }
                      </style>
                      <div class="school-detail-actions">
                        <button class="back-btn btn secondary"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                      </div>
                      
                      <h2 class="school-form-title">
                        <i class="fas fa-school" style="margin-right:10px;"></i>Application for School Integrated Projects
                      </h2>
                      
                      <div class="school-institute-header">
                        <p style="margin:0; font-weight:600; color:#800000; font-size:1.1rem;"><i class="fas fa-university" style="margin-right:8px;"></i>Nucleon Coaching Institute, Durgapur</p>
                      </div>

                      <div class="school-date-section">
                        <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;"><i class="fas fa-calendar-alt" style="color:#800000; margin-right:8px;"></i>Application Date:</label>
                        <div class="school-value">${app.application_date || 'Not specified'}</div>
                      </div>

                      <div class="school-info-section">
                        <h3 class="school-section-title">
                          <i class="fas fa-info-circle" style="margin-right:8px;"></i>School Information
                        </h3>
                        
                        <div class="school-grid">
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-school" style="color:#800000; margin-right:5px;"></i>School Name:</label>
                            <div class="school-value">${app.school_name || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-map-marker-alt" style="color:#800000; margin-right:5px;"></i>Address:</label>
                            <div class="school-value" style="white-space:pre-wrap;">${app.address || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-user-tie" style="color:#800000; margin-right:5px;"></i>Principal's Name:</label>
                            <div class="school-value">${app.principal_name || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-phone" style="color:#800000; margin-right:5px;"></i>Contact Number:</label>
                            <div class="school-value">${app.contact_number || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-envelope" style="color:#800000; margin-right:5px;"></i>Email Address:</label>
                            <div class="school-value">${app.email || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-certificate" style="color:#800000; margin-right:5px;"></i>Affiliated Board:</label>
                            <div class="school-value">${app.affiliated_board || ''}</div>
                          </div>
                        </div>
                      </div>

                      <div class="school-project-types">
                        <label style="display:block; font-weight:600; color:#333; margin-bottom:12px; font-size:1.1rem;">
                          <i class="fas fa-tasks" style="color:#800000; margin-right:5px;"></i>Type of Integrated Project Requested:
                        </label>
                        <div class="school-project-list">
                          ${projectTypes.length > 0 ? projectTypes.map(type => `<div class="school-project-item">${type}</div>`).join('') : '<div class="school-project-item">No project types specified</div>'}
                        </div>
                      </div>

                      <div class="school-info-section">
                        <div class="school-field">
                          <label class="school-label"><i class="fas fa-bullseye" style="color:#800000; margin-right:5px;"></i>Objective of the Project:</label>
                          <div class="school-value" style="white-space:pre-wrap; min-height:60px;">${app.objective || ''}</div>
                        </div>
                        <div class="school-field">
                          <label class="school-label"><i class="fas fa-users" style="color:#800000; margin-right:5px;"></i>Target Audience:</label>
                          <div class="school-value" style="white-space:pre-wrap;">${app.target_audience || ''}</div>
                        </div>
                        
                        <div class="school-grid" style="margin-top:20px;">
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-clock" style="color:#800000; margin-right:5px;"></i>Expected Duration:</label>
                            <div class="school-value">${app.duration || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-user-friends" style="color:#800000; margin-right:5px;"></i>Students Involved:</label>
                            <div class="school-value">${app.students_involved || ''}</div>
                          </div>
                        </div>

                        <div class="school-field" style="margin-top:20px;">
                          <label class="school-label"><i class="fas fa-tools" style="color:#800000; margin-right:5px;"></i>Resources Required from Nucleon:</label>
                          <div class="school-value" style="white-space:pre-wrap; min-height:60px;">${app.resources_required || ''}</div>
                        </div>
                      </div>

                      <div class="school-info-section">
                        <h3 class="school-section-title">
                          <i class="fas fa-plus-circle" style="margin-right:8px;"></i>Additional Information
                        </h3>
                        
                        <div class="school-field">
                          <label class="school-label"><i class="fas fa-history" style="color:#800000; margin-right:5px;"></i>Previous Projects Implemented (if any):</label>
                          <div class="school-value" style="white-space:pre-wrap; min-height:60px;">${app.previous_projects || ''}</div>
                        </div>
                        <div class="school-field">
                          <label class="school-label"><i class="fas fa-lightbulb" style="color:#800000; margin-right:5px;"></i>Why will this project benefit your students?</label>
                          <div class="school-value" style="white-space:pre-wrap; min-height:60px;">${app.benefits || ''}</div>
                        </div>
                      </div>

                      <div class="school-declaration-section">
                        <h3 style="color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; text-align:center;">
                          <i class="fas fa-file-signature" style="margin-right:8px;"></i>Declaration & Signature
                        </h3>
                        
                        <div class="school-declaration-text">
                          <p style="margin:0;">I, the undersigned, hereby declare that the information provided above is true and accurate to the best of my knowledge. I understand that submitting this application does not guarantee approval and that further discussions may be required.</p>
                        </div>
                        
                        <div class="school-signature-grid">
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-user" style="color:#800000; margin-right:5px;"></i>Principal's Name:</label>
                            <div class="school-value">${app.declaration_principal || app.principal_name || ''}</div>
                          </div>
                          <div class="school-field">
                            <label class="school-label"><i class="fas fa-calendar" style="color:#800000; margin-right:5px;"></i>Signature Date:</label>
                            <div class="school-value">${app.declaration_date || app.application_date || ''}</div>
                          </div>
                        </div>
                      </div>
                    </div>`;
                    showDetailView(html);
                }
            } catch (err) { 
                console.error("Error loading application:", err);
                showNotification('Failed to load application details.', 'error');
            }
        }
        
        async function viewStudyCenterApplication(id) {
            try {
                const res = await fetch(`${API_BASE}/study-centre-applications/${id}`);
                const json = await res.json();
                if (json.success) {
                    const app = json.data;
                    const html = `
                    <div class="panel study-detail-panel">
                      <style>
                        .study-detail-panel { background: linear-gradient(145deg, #f8f9fa, #ffffff); border: 2px solid #800000; border-radius: 15px; padding: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
                        .study-detail-actions { display:flex; justify-content:space-between; align-items:center; gap:0; width:100%; max-width:960px; margin:0 auto 14px; padding:0 8px; }
                        .study-detail-actions .btn { background:#800000; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; width:auto !important; max-width:none; flex:0 0 auto !important; white-space:nowrap; }
                        .study-detail-actions .btn.secondary { background:#555; }
                        .study-form-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:25px; text-align:center; font-size:1.8rem; border-bottom:3px solid #800000; padding-bottom:10px; }
                        .study-institute-header { background: rgba(128,0,0,0.05); border-left: 4px solid #800000; padding: 15px; margin-bottom: 25px; border-radius: 0 8px 8px 0; }
                        .study-intro-section { font-size: 1.1rem; line-height: 1.8; margin-bottom: 30px; color: #444; background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #800000; }
                        .study-info-section { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
                        .study-section-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; border-bottom:2px solid #800000; padding-bottom:8px; display:inline-block; }
                        .study-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px; }
                        .study-field { margin-bottom: 20px; }
                        .study-label { display:block; font-weight:600; color:#333; margin-bottom:8px; }
                        .study-value { width:100%; border:2px solid #e9ecef; border-radius:8px; padding:12px; font-size:1rem; background:#f8f9fa; color:#333; min-height:20px; }
                        .study-terms-section { background: rgba(128,0,0,0.02); padding: 20px; border-radius: 8px; border-left: 4px solid #800000; }
                        .study-responsibilities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
                        .study-responsibility-box { background: rgba(128,0,0,0.03); padding: 20px; border-radius: 8px; border: 1px solid rgba(128,0,0,0.1); }
                        .study-declaration-section { background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.1)); border: 2px solid #800000; border-radius: 12px; padding: 25px; margin-bottom: 25px; }
                        .study-declaration-text { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #800000; margin-bottom: 20px; }
                        .study-signature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; background: white; padding: 20px; border-radius: 8px; }
                        @media print { body *{visibility:hidden;} #application-detail-view, #application-detail-view *{visibility:visible;} #application-detail-view{position:absolute; inset:0;} .study-detail-actions{display:none!important;} }
                      </style>
                      <div class="study-detail-actions">
                        <button class="back-btn btn secondary"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                      </div>
                      
                      <h2 class="study-form-title">
                        <i class="fas fa-graduation-cap" style="margin-right:10px;"></i>Application for Study Centre Partnership
                      </h2>
                      
                      <div class="study-institute-header">
                        <p style="margin:0; font-weight:600; color:#800000; font-size:1.1rem;"><i class="fas fa-university" style="margin-right:8px;"></i>Nucleon Coaching Institute, Durgapur</p>
                      </div>

                      <div class="study-intro-section">
                        I, <strong style="color:#800000;">${app.principal_name_intro || app.principal_name || ''}</strong>, propose to establish a <strong>Nucleon Study Center</strong> at <strong style="color:#800000;">${app.centre_name || ''}</strong> in collaboration with Nucleon Coaching Institutes to provide quality education and support to local students in achieving their academic goals.
                      </div>

                      <div class="study-info-section">
                        <h3 class="study-section-title">
                          <i class="fas fa-user" style="margin-right:8px;"></i>Applicant Information
                        </h3>
                        
                        <div class="study-grid">
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-calendar-alt" style="color:#800000; margin-right:5px;"></i>Application Date:</label>
                            <div class="study-value">${app.application_date || 'Not specified'}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-user-circle" style="color:#800000; margin-right:5px;"></i>Principal Name:</label>
                            <div class="study-value">${app.principal_name || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-phone" style="color:#800000; margin-right:5px;"></i>Contact Number:</label>
                            <div class="study-value">${app.contact_number || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-envelope" style="color:#800000; margin-right:5px;"></i>Email Address:</label>
                            <div class="study-value">${app.email || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-graduation-cap" style="color:#800000; margin-right:5px;"></i>Affiliated Board:</label>
                            <div class="study-value">${app.affiliated_board || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-clock" style="color:#800000; margin-right:5px;"></i>Experience (Years):</label>
                            <div class="study-value">${app.experience || ''}</div>
                          </div>
                        </div>

                        <div style="margin-top: 20px;">
                          <label class="study-label"><i class="fas fa-map-marker-alt" style="color:#800000; margin-right:5px;"></i>Complete Address:</label>
                          <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.address || ''}</div>
                        </div>
                      </div>

                      <div class="study-info-section">
                        <h3 class="study-section-title">
                          <i class="fas fa-building" style="margin-right:8px;"></i>Study Centre Details
                        </h3>
                        
                        <div class="study-grid">
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-book" style="color:#800000; margin-right:5px;"></i>Available Courses:</label>
                            <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.available_courses || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-laptop" style="color:#800000; margin-right:5px;"></i>Infrastructure:</label>
                            <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.infrastructure || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-users" style="color:#800000; margin-right:5px;"></i>Staff Strength:</label>
                            <div class="study-value">${app.staff_strength || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-user-graduate" style="color:#800000; margin-right:5px;"></i>Student Capacity:</label>
                            <div class="study-value">${app.student_capacity || ''}</div>
                          </div>
                        </div>
                      </div>

                      <div class="study-info-section">
                        <h3 class="study-section-title">
                          <i class="fas fa-info-circle" style="margin-right:8px;"></i>Additional Information
                        </h3>
                        
                        <div class="study-grid">
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-tools" style="color:#800000; margin-right:5px;"></i>Resources Required:</label>
                            <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.resources_required || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-briefcase" style="color:#800000; margin-right:5px;"></i>Previous Experience:</label>
                            <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.previous_experience || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-star" style="color:#800000; margin-right:5px;"></i>Benefits of Partnership:</label>
                            <div class="study-value" style="white-space:pre-wrap; min-height:60px;">${app.benefits || ''}</div>
                          </div>
                        </div>
                      </div>

                      <div class="study-info-section">
                        <h3 class="study-section-title">
                          <i class="fas fa-file-contract" style="margin-right:8px;"></i>Agreement Terms & Conditions
                        </h3>
                        
                        <div class="study-terms-section">
                          <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-info-circle" style="margin-right: 8px;"></i>Key Terms:</h4>
                          <ul style="color: #444; line-height: 1.6; margin: 0; padding-left: 20px;">
                            <li><strong>Duration:</strong> This Agreement shall be valid for a period of three (3) years from the date of signing.</li>
                            <li><strong>Investment:</strong> The total investment amount is ₹3,00,000/- for the duration of three years.</li>
                            <li><strong>Renewal:</strong> The agreement will be renewed after mutual consent of both parties.</li>
                            <li><strong>Study Materials:</strong> Must procure study materials and Daily Practice Papers (DPPs) from Nucleon Coaching Institute, Durgapur.</li>
                            <li><strong>Initial Package:</strong> Must receive 30 copies including foundation crash course materials, dropper materials, and regular study materials combined.</li>
                            <li><strong>Jurisdiction:</strong> Any disputes shall be settled in Guwahati, Assam.</li>
                          </ul>
                        </div>
                      </div>

                      <div class="study-info-section">
                        <h3 class="study-section-title">
                          <i class="fas fa-handshake" style="margin-right:8px;"></i>Responsibilities
                        </h3>
                        
                        <div class="study-responsibilities-grid">
                          <div class="study-responsibility-box">
                            <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.1rem;"><i class="fas fa-user-check" style="margin-right: 8px;"></i>Applicant Responsibilities:</h4>
                            <ul style="color: #555; line-height: 1.5; margin: 0; padding-left: 18px; font-size: 0.95rem;">
                              <li>Establish and operate the Study Centre according to Nucleon guidelines</li>
                              <li>Procure study materials and DPPs from Nucleon Coaching Institute</li>
                              <li>Maintain quality standards as set by the Institute</li>
                              <li>Ensure proper management of the Study Centre</li>
                            </ul>
                          </div>
                          <div class="study-responsibility-box">
                            <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.1rem;"><i class="fas fa-university" style="margin-right: 8px;"></i>Institute Responsibilities:</h4>
                            <ul style="color: #555; line-height: 1.5; margin: 0; padding-left: 18px; font-size: 0.95rem;">
                              <li>Provide necessary support, training and resources</li>
                              <li>Facilitate marketing and promotional activities</li>
                              <li>Supply quality study materials and resources</li>
                              <li>Ongoing guidance and support for center success</li>
                            </ul>
                          </div>
                        </div>
                      </div>

                      <div class="study-declaration-section">
                        <h3 style="color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; text-align:center;">
                          <i class="fas fa-file-signature" style="margin-right:8px;"></i>Declaration & Agreement
                        </h3>
                        
                        <div class="study-declaration-text">
                          <p style="color:#333; line-height:1.6; margin-bottom:15px; text-align:justify; font-size: 1rem;">
                            I, the undersigned, hereby declare that the information provided above is true and accurate to the best of my knowledge. I understand and agree to all the terms and conditions mentioned in this agreement. I acknowledge that submitting this application does not guarantee approval and that further discussions may be required.
                          </p>
                          <p style="color:#333; line-height:1.6; margin:0; text-align:justify; font-size: 1rem;">
                            I agree to establish and operate the Study Centre in accordance with the guidelines and standards set forth by Nucleon Coaching Institute and understand that this agreement shall be governed by the laws mentioned herein.
                          </p>
                        </div>
                        
                        <div class="study-signature-grid">
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-signature" style="color:#800000; margin-right:5px;"></i>Principal's Name (for Signature):</label>
                            <div class="study-value">${app.declaration_principal || app.principal_name || ''}</div>
                          </div>
                          <div class="study-field">
                            <label class="study-label"><i class="fas fa-calendar" style="color:#800000; margin-right:5px;"></i>Declaration Date:</label>
                            <div class="study-value">${app.declaration_date || app.application_date || ''}</div>
                          </div>
                        </div>
                      </div>
                    </div>`;
                    showDetailView(html);
                }
            } catch (err) { 
                console.error("Error loading study center:", err);
                showNotification('Failed to load study center details.', 'error');
            }
        }

        async function viewDistanceLearningApplication(id) {
            try {
                const res = await fetch(`${API_BASE}/distance-learning/${id}`);
                const json = await res.json();
                if (json.success) {
                    const app = json.data;
                    const html = `
                    <div class="panel distance-detail-panel">
                      <style>
                        .distance-detail-panel { background: linear-gradient(145deg, #f8f9fa, #ffffff); border: 2px solid #800000; border-radius: 15px; padding: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
                        .distance-detail-actions { display:flex; justify-content:space-between; align-items:center; gap:0; width:100%; max-width:960px; margin:0 auto 14px; padding:0 8px; }
                        .distance-detail-actions .btn { background:#800000; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; width:auto !important; max-width:none; flex:0 0 auto !important; white-space:nowrap; }
                        .distance-detail-actions .btn.secondary { background:#555; }
                        .distance-form-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:25px; text-align:center; font-size:1.8rem; border-bottom:3px solid #800000; padding-bottom:10px; }
                        .distance-institute-header { background: rgba(128,0,0,0.05); border-left: 4px solid #800000; padding: 15px; margin-bottom: 25px; border-radius: 0 8px 8px 0; }
                        .distance-intro-section { font-size: 1.1rem; line-height: 1.8; margin-bottom: 30px; color: #444; background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #800000; }
                        .distance-info-section { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
                        .distance-section-title { color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; border-bottom:2px solid #800000; padding-bottom:8px; display:inline-block; }
                        .distance-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px; }
                        .distance-field { margin-bottom: 20px; }
                        .distance-label { display:block; font-weight:600; color:#333; margin-bottom:8px; }
                        .distance-value { width:100%; border:2px solid #e9ecef; border-radius:8px; padding:12px; font-size:1rem; background:#f8f9fa; color:#333; min-height:20px; }
                        .distance-terms-section { background: rgba(128,0,0,0.02); padding: 20px; border-radius: 8px; border-left: 4px solid #800000; }
                        .distance-responsibilities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
                        .distance-responsibility-box { background: rgba(128,0,0,0.03); padding: 20px; border-radius: 8px; border: 1px solid rgba(128,0,0,0.1); }
                        .distance-declaration-section { background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.1)); border: 2px solid #800000; border-radius: 12px; padding: 25px; margin-bottom: 25px; }
                        .distance-declaration-text { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #800000; margin-bottom: 20px; }
                        .distance-signature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; background: white; padding: 20px; border-radius: 8px; }
                        @media print { body *{visibility:hidden;} #application-detail-view, #application-detail-view *{visibility:visible;} #application-detail-view{position:absolute; inset:0;} .distance-detail-actions{display:none!important;} }
                      </style>
                      <div class="distance-detail-actions">
                        <button class="back-btn btn secondary"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                      </div>
                      
                      <h2 class="distance-form-title">
                        <i class="fas fa-laptop-code" style="margin-right:10px;"></i>Agreement for Distance Learning Program
                      </h2>
                      
                      <div class="distance-institute-header">
                        <p style="margin:0; font-weight:600; color:#800000; font-size:1.1rem;"><i class="fas fa-university" style="margin-right:8px;"></i>Nucleon Coaching Institute, Durgapur</p>
                      </div>

                      <div class="distance-intro-section">
                        This Agreement is made on <strong style="color:#800000;">${app.agreement_date || app.application_date || 'N/A'}</strong> between:
                        <br><br>
                        <strong>Nucleon Coaching Institute, Durgapur</strong><br>
                        <br>
                        <strong>AND</strong><br><br>
                        Name of Applicant: <strong style="color:#800000;">${app.applicant_name || 'N/A'}</strong><br>
                        Address of Applicant: <strong style="color:#800000;">${app.applicant_address || 'N/A'}</strong><br>
                        (Hereinafter referred to as "Applicant")<br><br>
                        <strong>Subject: Establishment of a Distance Learning Program</strong>
                      </div>

                      <div class="distance-info-section">
                        <h3 class="distance-section-title">
                          <i class="fas fa-user" style="margin-right:8px;"></i>Applicant Information
                        </h3>
                        
                        <div class="distance-grid">
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-calendar-alt" style="color:#800000; margin-right:5px;"></i>Application Date:</label>
                            <div class="distance-value">${app.application_date || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-phone" style="color:#800000; margin-right:5px;"></i>Contact Number:</label>
                            <div class="distance-value">${app.contact_number || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-envelope" style="color:#800000; margin-right:5px;"></i>Email Address:</label>
                            <div class="distance-value">${app.email_address || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-graduation-cap" style="color:#800000; margin-right:5px;"></i>Educational Qualification:</label>
                            <div class="distance-value">${app.educational_qualification || 'N/A'}</div>
                          </div>
                        </div>
                      </div>

                      <div class="distance-info-section">
                        <h3 class="distance-section-title">
                          <i class="fas fa-laptop" style="margin-right:8px;"></i>Distance Learning Program Details
                        </h3>
                        
                        <div class="distance-grid">
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-map" style="color:#800000; margin-right:5px;"></i>Center Area for Study Centre:</label>
                            <div class="distance-value">${app.center_area || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-rupee-sign" style="color:#800000; margin-right:5px;"></i>Minimum Amount of Investment:</label>
                            <div class="distance-value" style="background-color: #f8f9fa; color: #800000; font-weight: 600;">₹1,00,000/- (One Lakh Rupees)</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-school" style="color:#800000; margin-right:5px;"></i>Number of Schools in the Area:</label>
                            <div class="distance-value">${app.number_of_schools || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-users" style="color:#800000; margin-right:5px;"></i>Average Number of Students Passed in Class X Each Year:</label>
                            <div class="distance-value">${app.avg_students || 'N/A'}</div>
                          </div>
                        </div>
                      </div>

                      <div class="distance-info-section">
                        <h3 class="distance-section-title">
                          <i class="fas fa-file-contract" style="margin-right:8px;"></i>Agreement Terms & Conditions
                        </h3>
                        
                        <div class="distance-terms-section" style="margin-bottom: 20px;">
                          <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-clock" style="margin-right: 8px;"></i> Duration of Agreement:</h4>
                          <p style="margin: 0; color: #444; line-height: 1.6;">This Agreement shall be valid for a period of <strong>three (3) years</strong> from the date of signing.</p>
                        </div>

                        <div class="distance-terms-section" style="margin-bottom: 20px;">
                          <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-money-bill-wave" style="margin-right: 8px;"></i> Financial Terms:</h4>
                          <ul style="color: #444; line-height: 1.6; margin: 0; padding-left: 20px;">
                            <li>The total investment amount is <strong>₹1,00,000/-</strong> for the duration of three years.</li>
                            <li>The agreement will be renewed after mutual consent of both parties.</li>
                          </ul>
                        </div>

                        <div class="distance-terms-section">
                          <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.2rem;"><i class="fas fa-gavel" style="margin-right: 8px;"></i> Jurisdiction:</h4>
                          <p style="margin: 0; color: #444; line-height: 1.6;">Any disputes arising out of or in connection with this Agreement shall be settled in <strong>Guwahati, Assam</strong>.</p>
                        </div>
                      </div>

                      <div class="distance-info-section">
                        <h3 class="distance-section-title">
                          <i class="fas fa-handshake" style="margin-right:8px;"></i>Responsibilities
                        </h3>
                        
                        <div class="distance-responsibilities-grid">
                          <div class="distance-responsibility-box">
                            <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.1rem;"><i class="fas fa-user-check" style="margin-right: 8px;"></i> Responsibilities of the Applicant:</h4>
                            <ul style="color: #555; line-height: 1.5; margin: 0; padding-left: 18px; font-size: 0.95rem;">
                              <li>The Applicant agrees to procure study materials and Daily Practice Papers (DPPs) from Nucleon Coaching Institute, Durgapur.</li>
                              <li>At the initial stage, the Applicant must receive 30 copies which include foundation crash course materials, dropper materials, and regular study materials combined.</li>
                            </ul>
                          </div>
                          <div class="distance-responsibility-box">
                            <h4 style="color: #800000; margin-bottom: 15px; font-size: 1.1rem;"><i class="fas fa-university" style="margin-right: 8px;"></i> Responsibilities of the Institute:</h4>
                            <ul style="color: #555; line-height: 1.5; margin: 0; padding-left: 18px; font-size: 0.95rem;">
                              <li>The Institute will provide necessary support, including training and resources, to help the Distance Learning Program succeed.</li>
                              <li>The Institute will facilitate marketing and promotional activities for the Distance Learning Program.</li>
                            </ul>
                          </div>
                        </div>
                      </div>

                      <div class="distance-info-section">
                        <h3 class="distance-section-title">
                          <i class="fas fa-list-alt" style="margin-right:8px;"></i>Additional Terms
                        </h3>
                        
                        <div style="display: grid; gap: 20px;">
                          <div style="background: rgba(128,0,0,0.02); padding: 15px; border-radius: 8px; border-left: 4px solid #800000;">
                            <h4 style="color: #800000; margin-bottom: 10px; font-size: 1.1rem;"><i class="fas fa-times-circle" style="margin-right: 8px;"></i> Termination:</h4>
                            <p style="margin: 0; color: #444; line-height: 1.6; font-size: 0.95rem;">This Agreement may be terminated by either party with written notice of at least thirty (30) days if either party fails to meet their obligations under this Agreement.</p>
                          </div>
                          <div style="background: rgba(128,0,0,0.02); padding: 15px; border-radius: 8px; border-left: 4px solid #800000;">
                            <h4 style="color: #800000; margin-bottom: 10px; font-size: 1.1rem;"><i class="fas fa-balance-scale" style="margin-right: 8px;"></i> Governing Law:</h4>
                            <p style="margin: 0; color: #444; line-height: 1.6; font-size: 0.95rem;">This Agreement shall be governed by and construed in accordance with the laws of India.</p>
                          </div>
                          <div style="background: rgba(128,0,0,0.02); padding: 15px; border-radius: 8px; border-left: 4px solid #800000;">
                            <h4 style="color: #800000; margin-bottom: 10px; font-size: 1.1rem;"><i class="fas fa-info-circle" style="margin-right: 8px;"></i> Miscellaneous:</h4>
                            <ul style="color: #444; line-height: 1.5; margin: 0; padding-left: 18px; font-size: 0.95rem;">
                              <li>Any amendments to this Agreement must be made in writing and signed by both parties.</li>
                              <li>This Agreement constitutes the entire understanding between the parties and supersedes all prior discussions or agreements.</li>
                            </ul>
                          </div>
                        </div>
                      </div>

                      <div class="distance-declaration-section">
                        <h3 style="color:#800000; font-family:'Oswald',sans-serif; margin-bottom:20px; font-size:1.4rem; text-align:center;">
                          <i class="fas fa-file-signature" style="margin-right:8px;"></i>Declaration & Agreement
                        </h3>
                        
                        <div class="distance-declaration-text">
                          <p style="color:#333; line-height:1.6; margin-bottom:15px; text-align:justify; font-size: 1rem;">
                            <strong>IN WITNESS WHEREOF</strong>, the parties hereto have executed this Agreement as of the day and year first above written. I, the undersigned, hereby declare that the information provided above is true and accurate to the best of my knowledge. I understand and agree to all the terms and conditions mentioned in this agreement.
                          </p>
                          <p style="color:#333; line-height:1.6; margin:0; text-align:justify; font-size: 1rem;">
                            I acknowledge that submitting this application does not guarantee approval and that further discussions may be required. I agree to establish and operate the Distance Learning Program in accordance with the guidelines and standards set forth by Nucleon Coaching Institute.
                          </p>
                        </div>
                        
                        <div class="distance-signature-grid">
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-signature" style="color:#800000; margin-right:5px;"></i>Applicant's Name (for Signature):</label>
                            <div class="distance-value">${app.signature_name || app.applicant_name || 'N/A'}</div>
                          </div>
                          <div class="distance-field">
                            <label class="distance-label"><i class="fas fa-calendar" style="color:#800000; margin-right:5px;"></i>Signature Date:</label>
                            <div class="distance-value">${app.signature_date || app.application_date || 'N/A'}</div>
                          </div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 8px; font-style: italic; color: #666; text-align: center;">
                          <p style="margin: 0; font-size: 0.9rem;"><i class="fas fa-info-circle" style="margin-right: 8px; color: #800000;"></i>Note: Please fill in all the required information before signing the agreement.</p>
                        </div>
                      </div>
                    </div>`;
                    showDetailView(html);
                }
            } catch (err) { 
                console.error("Error loading distance learning app:", err);
                showNotification('Failed to load distance learning details.', 'error');
            }
        }

        async function viewContactSubmission(id) {
            try {
                const res = await fetch(`${API_BASE}/contacts/${id}`);
                const json = await res.json();
                if (json.success) {
                    const c = json.data;
                    const html = `
                    <div class="panel contact-detail-panel">
                      <style>
                        .contact-detail-panel .application-form { background:#fff; border-radius:12px; padding:24px; box-shadow:0 4px 16px rgba(0,0,0,0.06); }
                        .contact-detail-panel h2 { font-family:'Oswald',sans-serif; color:#800000; margin:0 0 12px; display:flex; align-items:center; gap:10px; }
                        .contact-detail-panel .date-input { margin:8px 0 20px; font-weight:600; }
                        .contact-detail-panel fieldset { border:2px solid #800000; border-radius:12px; padding:16px; margin:14px 0 22px; background:#fafbfc; }
                        .contact-detail-panel legend { padding:4px 12px; border:2px solid #800000; border-radius:12px; color:#800000; font-weight:700; background:#fff; display:inline-flex; align-items:center; gap:8px; }
                        .contact-detail-panel .form-group { margin-bottom:14px; }
                        .contact-detail-panel label { display:block; font-weight:600; margin-bottom:6px; }
                        .contact-detail-panel .readonly-box { background:#fff; border:1px solid #e0e0e0; border-radius:10px; padding:12px 14px; }
                        .contact-detail-actions { display:flex; justify-content:space-between; align-items:center; gap:0; width:100%; max-width:960px; margin:0 auto 14px; padding:0 8px; }
                        .contact-detail-actions .btn { background:#800000; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; width:auto !important; max-width:none; flex:0 0 auto !important; white-space:nowrap; }
                        .contact-detail-actions .btn.secondary { background:#555; }
                        @media print { body *{visibility:hidden;} #application-detail-view, #application-detail-view *{visibility:visible;} #application-detail-view{position:absolute; inset:0;} .contact-detail-actions{display:none!important;} }
                      </style>
                      <div class="contact-detail-actions">
                        <button class="back-btn btn secondary"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                      </div>
                      <section class="application-form">
                        <h2><i class="fas fa-envelope-open-text"></i> Contact Submission Details</h2>
                        <div class="date-input"><label>Submission Date:</label> <span>${c.submitted_at || ''}</span></div>
                        <fieldset>
                          <legend><i class="fas fa-user"></i> Contact</legend>
                          <div class="form-group"><label>Full Name:</label><div class="readonly-box">${c.name || ''}</div></div>
                          <div class="form-group"><label>Email Address:</label><div class="readonly-box">${c.email || ''}</div></div>
                          <div class="form-group"><label>Phone Number:</label><div class="readonly-box">${c.phone || ''}</div></div>
                        </fieldset>
                        <fieldset>
                          <legend><i class="fas fa-book"></i> Program</legend>
                          <div class="form-group"><label>Program Interest:</label><div class="readonly-box">${c.program || ''}</div></div>
                          <div class="form-group"><label>Message:</label><div class="readonly-box">${c.message || ''}</div></div>
                        </fieldset>
                      </section>
                    </div>`;
                    showDetailView(html);
                }
            } catch (err) { 
                console.error("Error loading contact:", err);
                showNotification('Failed to load contact details.', 'error');
            }
        }

        async function viewEducatorApplication(id) {
            try {
                const res = await fetch(`${API_BASE}/educators/${id}`);
                const json = await res.json();
                if (json.success) {
                    const app = json.data;
                    const submitted = app.submitted_at || app.created_at || '';
                    const submittedDate = formatDateShort(submitted);
                    const dobDate = app.dob ? formatDateShort(app.dob) : '';
                    const html = `
                    <div class="panel educator-detail-panel">
                      <style>
                        .educator-detail-panel .application-form { background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
                        .educator-detail-panel h2 { font-family: 'Oswald', sans-serif; color: #800000; margin: 0 0 12px; display:flex; align-items:center; gap:10px; }
                        .educator-detail-panel .date-input { margin: 8px 0 20px; font-weight: 600; }
                        .educator-detail-panel fieldset { border:2px solid #800000; border-radius: 12px; padding: 16px; margin: 14px 0 22px; background:#fafbfc; }
                        .educator-detail-panel legend { padding: 4px 12px; border:2px solid #800000; border-radius: 12px; color:#800000; font-weight:700; background:#fff; display:inline-flex; align-items:center; gap:8px; }
                        .educator-detail-panel .form-group { margin-bottom: 14px; }
                        .educator-detail-panel label { display:block; font-weight:600; margin-bottom:6px; }
                        .educator-detail-panel .readonly-box { background:#fff; border:1px solid #e0e0e0; border-radius:10px; padding:12px 14px; }
                        .educator-detail-panel .two-column { display:grid; grid-template-columns: repeat(2,1fr); gap:14px; }
                        .educator-detail-actions { display:flex; justify-content:space-between; align-items:center; gap:0; width:100%; max-width:960px; margin:0 auto 14px; padding:0 8px; }
                        .educator-detail-actions .btn { background:#800000; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; width:auto !important; max-width:none; flex:0 0 auto !important; white-space:nowrap; }
                        .educator-detail-actions .btn.secondary { background:#555; }
                        @media print {
                          body * { visibility: hidden; }
                          #application-detail-view, #application-detail-view * { visibility: visible; }
                          #application-detail-view { position: absolute; inset: 0; }
                          .educator-detail-actions { display:none !important; }
                        }
                      </style>
                      <div class="educator-detail-actions">
                        <button class="back-btn btn secondary"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="btn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                      </div>
                      <section class="application-form">
                        <h2><i class="fas fa-chalkboard-teacher"></i> Educator Application Form</h2>
                        <div class="date-input">
                          <label>Application Date:</label>
                          <span>${submittedDate}</span>
                        </div>
                        <fieldset>
                          <legend><i class="fas fa-user"></i> Personal Information</legend>
                          <div class="form-group">
                            <label>Full Name:</label>
                            <div class="readonly-box">${app.full_name || ''}</div>
                          </div>
                          <div class="two-column">
                            <div class="form-group">
                              <label>Date of Birth:</label>
                              <div class="readonly-box">${dobDate}</div>
                            </div>
                            <div class="form-group">
                              <label>Gender:</label>
                              <div class="readonly-box">${app.gender || ''}</div>
                            </div>
                          </div>
                          <div class="form-group">
                            <label>Address:</label>
                            <div class="readonly-box">${app.address || ''}</div>
                          </div>
                          <div class="two-column">
                            <div class="form-group">
                              <label>Contact Number:</label>
                              <div class="readonly-box">${app.phone || ''}</div>
                            </div>
                            <div class="form-group">
                              <label>Email Address:</label>
                              <div class="readonly-box">${app.email || ''}</div>
                            </div>
                          </div>
                          <div class="form-group">
                            <label>Resume:</label>
                            <div class="readonly-box"><a href="${API_BASE}/educators/${app.id}/resume" target="_blank" rel="noopener">Download</a></div>
                          </div>
                        </fieldset>
                      </section>
                    </div>`;
                    showDetailView(html);
                }
            } catch (err) {
                console.error('Error loading educator:', err);
                showNotification('Failed to load educator details.', 'error');
            }
        }

        async function handleDelete(id, type) {
            if (!confirm('Move this item to trash?')) return;
            
            const urls = {
                'school-project': `${API_BASE}/school-projects/${id}`,
                'study-center': `${API_BASE}/study-centre-applications/${id}`,
                'distance-learning': `${API_BASE}/distance-learning/${id}`,
                'contact': `${API_BASE}/contacts/${id}`,
                'educator': `${API_BASE}/educators/${id}`
            };
            const loadFunctions = {
                'school-project': loadSchoolProjects,
                'study-center': loadStudyCenters,
                'distance-learning': loadDistanceLearning,
                'contact': loadContactsFromApi,
                'educator': loadEducators
            };

            try {
                const response = await fetch(urls[type], { method: 'DELETE' });
                if (response.ok) {
                    showNotification('Item moved to trash.', 'success');
                    if (loadFunctions[type]) await loadFunctions[type]();
                } else {
                    throw new Error('Server responded with an error.');
                }
            } catch (error) {
                console.error('Error deleting item:', error);
                showNotification('Failed to delete item.', 'error');
            }
        }
        
        // --- VIEW & NAVIGATION ---
        function showListView() {
            applicationDetailView.classList.remove('active');
            applicationDetailView.innerHTML = '';
            if (statsCardsContainer) statsCardsContainer.style.display = 'grid';
            if (panelHeaderContainer) panelHeaderContainer.style.display = 'block';

            const currentPanelId = (location.hash || '').replace('#', '') || 'dashboard';
            allContentPanels.forEach(p => p.classList.remove('active'));
            
            const panelToShow = document.getElementById(currentPanelId);
            if (panelToShow) {
                panelToShow.classList.add('active');
                if (currentPanelId !== 'dashboard' && statsCardsContainer) {
                    statsCardsContainer.style.display = 'none';
                }
            }
            updateActiveStats();
        }

        function showDetailView(htmlContent) {
            allContentPanels.forEach(section => section.classList.remove('active'));
            if (statsCardsContainer) statsCardsContainer.style.display = 'none';
            if (panelHeaderContainer) panelHeaderContainer.style.display = 'none';

            applicationDetailView.innerHTML = htmlContent;
            applicationDetailView.classList.add('active');

            const backBtn = applicationDetailView.querySelector('.back-btn');
            if (backBtn) {
                backBtn.addEventListener('click', () => history.back());
            }
        }

        function showPanel(id) {
            if(applicationDetailView.classList.contains('active')) {
                showListView();
            }

            allContentPanels.forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            const panelToShow = document.getElementById(id);
            const activeLink = document.querySelector(`a[data-target="${id}"]`);
            
            if(panelToShow) panelToShow.classList.add('active');
            if(activeLink) activeLink.classList.add('active');
            
            const panelTitleElement = document.getElementById('panelTitle');
            if (panelTitleElement) {
                panelTitleElement.textContent = activeLink ? activeLink.textContent.trim() : 'Dashboard';
            }
            if (statsCardsContainer) statsCardsContainer.style.display = (id === 'dashboard') ? 'grid' : 'none';
            if (panelHeaderContainer) panelHeaderContainer.style.display = (id === 'dashboard') ? 'block' : 'block';

            updateActiveStats();
        }

        // --- INITIALIZATION ---
        function initializeLogin() {
            loginForm?.addEventListener("submit", handleLogin);
            togglePassword?.addEventListener("click", function () {
                const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                passwordInput.setAttribute("type", type);
                this.classList.toggle("fa-eye");
                this.classList.toggle("fa-eye-slash");
            });
        }
        
        async function initializeDashboard() {
            await Promise.all([
                loadSchoolProjects(),
                loadStudyCenters(),
                loadDistanceLearning(),
                loadEducators(),
                loadContactsFromApi()
            ]);

            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const target = link.getAttribute('data-target');
                    if (!target) return;
                    history.pushState({ panel: target }, '', '#' + target);
                    showPanel(target);

                    // Auto-close mobile sidebar upon navigation
                    const sb = document.getElementById('sidebar');
                    const sbBackdrop = document.getElementById('sidebarBackdrop');
                    if (sb && sb.classList.contains('open')) sb.classList.remove('open');
                    if (sbBackdrop && sbBackdrop.classList.contains('show')) sbBackdrop.classList.remove('show');
                });
            });
            
            window.addEventListener('popstate', (e) => {
                const hash = location.hash.replace('#', '') || 'dashboard';
                showPanel(hash);
            });
            
            // Mobile Menu
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarBackdrop = document.getElementById('sidebarBackdrop');
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                sidebarBackdrop.classList.toggle('show');
            });
            sidebarBackdrop.addEventListener('click', () => {
                sidebar.classList.remove('open');
                sidebarBackdrop.classList.remove('show');
            });
            
            // Logout buttons
            document.getElementById('cancelLogoutBtn').addEventListener('click', cancelLogout);
            document.getElementById('performLogoutBtn').addEventListener('click', performLogout);

            const initialPanel = location.hash.replace('#', '') || 'dashboard';
            showPanel(initialPanel);
        }

        // --- SCRIPT ENTRY POINT ---
        document.addEventListener("DOMContentLoaded", initializeLogin);

    })();
  </script>

</body>

</html>